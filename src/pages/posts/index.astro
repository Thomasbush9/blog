---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('posts'))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const basePath = import.meta.env.BASE_URL ? import.meta.env.BASE_URL.replace(/^\/+|\/+$/g, '') : '';
const getPath = (path: string) => {
  if (!basePath) return path;
  return path === '/' ? `/${basePath}` : `/${basePath}${path}`;
};
---

<BaseLayout title="Posts" description="Blog posts">
  <h1><span class="prompt">$</span> ls posts/</h1>
  <p class="subtitle">Total: {posts.length} posts</p>

  <ul class="post-list">
    {posts.map((post) => (
      <li>
        <a href={getPath(`/posts/${post.slug}`)}>
          <span class="post-date">{post.data.pubDate.toISOString().split('T')[0]}</span>
          <span class="post-title">{post.data.title}</span>
        </a>
        {post.data.tags.length > 0 && (
          <div class="tags">
            {post.data.tags.map((tag) => (
              <span class="tag">{tag}</span>
            ))}
          </div>
        )}
      </li>
    ))}
  </ul>
</BaseLayout>

<style>
  .prompt {
    color: var(--accent-green);
    margin-right: 0.5rem;
  }

  .subtitle {
    color: var(--text-muted);
    font-family: var(--font-mono);
    margin-bottom: 2rem;
  }

  .post-list {
    list-style: none;
    padding: 0;
  }

  .post-list li {
    padding: 1rem 0;
    border-bottom: 1px solid var(--border);
  }

  .post-list a {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: baseline;
    font-family: var(--font-mono);
  }

  .post-list a:hover .post-title {
    color: var(--accent-sky);
  }

  .post-date {
    color: var(--text-muted);
    font-size: 0.85rem;
    flex-shrink: 0;
  }

  .post-title {
    color: var(--accent-blue);
    font-size: 1rem;
  }

  .tags {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.5rem;
    width: 100%;
    padding-left: calc(1rem + 85px);
  }

  .tag {
    font-family: var(--font-mono);
    font-size: 0.75rem;
    padding: 0.2rem 0.5rem;
    background: var(--bg-surface);
    border-radius: var(--radius-sm);
    color: var(--text-muted);
  }
</style>
